<?xml version="1.0" encoding="UTF-8"?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PlantAlarm.Views.TodayPage"
             xmlns:customControls="clr-namespace:PlantAlarm.CustomControls"
             Title="To-dos">
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Today" Clicked="BackToTodayTapped"/>
    </ContentPage.ToolbarItems>
    <ContentPage.Content>
        <StackLayout>
            <RelativeLayout>
                <ListView x:Name="DaysListView"
                          RowHeight="35"
                          Rotation="270"
                          RelativeLayout.XConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=0.5, Constant=-32}"
                          RelativeLayout.YConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=-0.5, Constant=32}"
                          RelativeLayout.WidthConstraint="{ConstraintExpression Type=Constant, Constant=50}"
                          RelativeLayout.HeightConstraint="{ConstraintExpression Type=RelativeToParent, Property=Width, Factor=1}"
                          ItemsSource="{Binding CalendarDays}" SelectedItem="{Binding SelectedDay}" VerticalScrollBarVisibility="Never"
                          SeparatorVisibility="None" ItemSelected="NewDaySelected">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <customControls:CalendarDayViewCell />
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </RelativeLayout>
            <ScrollView VerticalOptions="FillAndExpand">
                <ListView ItemsSource="{Binding ActivitiesForDay}" HasUnevenRows="false">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <ViewCell Height="88">
                                <StackLayout>
                                    <BoxView HeightRequest="1" HorizontalOptions="Fill" BackgroundColor="White" 
                                             VerticalOptions="Start"/>
                                    <StackLayout Orientation="Horizontal" Margin="10,5,10,5">
                                        <StackLayout Orientation="Vertical" HorizontalOptions="StartAndExpand">
                                            <Label Text="{Binding Name}" />
                                            <CollectionView ItemsSource="{Binding Plants}" Margin="10,0,0,0">
                                                <CollectionView.ItemsLayout>
                                                    <GridItemsLayout Orientation="Horizontal" Span="1" VerticalItemSpacing="3"
                                                                     HorizontalItemSpacing="5"/>
                                                </CollectionView.ItemsLayout>    
                                                <CollectionView.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackLayout>
                                                            <Image Source="{Binding Photo.Url}" HeightRequest="40" WidthRequest="40"
                                                                   Aspect="AspectFill" />
                                                        </StackLayout>
                                                    </DataTemplate>
                                                </CollectionView.ItemTemplate>
                                            </CollectionView>
                                        </StackLayout>
                                        <CheckBox IsChecked="{Binding PlantActivityItem.IsCompleted, Mode=TwoWay}" HorizontalOptions="End" />
                                    </StackLayout>
                                    <BoxView HeightRequest="1" HorizontalOptions="Fill" BackgroundColor="Gainsboro" 
                                             VerticalOptions="End" />
                                </StackLayout>
                            </ViewCell>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </ScrollView>
        </StackLayout>
    </ContentPage.Content>
</ContentPage>
